## 5. Lectura e interpretación de [[permisos]] (1-2)

`echo "Hola mundo" > myarchivo.txt`
A un archivo le metemos texto (no es acumulativo), es decir, si después hacemos otro `echo` con "Adiós", al hacer el `cat` encontraremos un "Adiós".

`echo "Hola mundo" >> myarchivo.txt`
Va apilando el texto.

`rm myarchivo.txt`
Borrar archivo.

`ls -l`
Ver los permisos de los archivos que hayan en un directorio.

> **[[rwx]] = read, write, atravesar el directorio.**

> **3 pares de permisos: permisos de propietario (u), permisos de grupos (g) y permisos de otros (o).

Cuándo vemos los permisos:

- Al principio de cada línea, si pone una `d`... = directorio.

Curiosidad: `cat /etc/login.defs | grep "ENCRYPT_METHOD"` te reporta el método en el que esta contraseña figura en el ``/etc/shadow`.

## 6.  Asignación de permisos (1-2)

Con [[chmod]] cambias los privilegios:

`chmod *grupo*+*privilegio* *directorio*`
`chmod o+w prueba/`
A *otros* le hemos añadido el permiso de *write* al directorio *prueba*.

>`rm -r directorio`: borrar tanto este directorio como todos sus subdirectorios.

`chmod o-w prueba/`
Ahora *otros* no pueden escribir.

[[chgrp]] `usuario directorio` 
`chgrp alfonso prueba` 
Estamos añadiendo el grupo *alfonso*, para darle permisos de manera individual.

`chmod g+w prueba/`
Ahora los grupos pueden escribir, y cómo tengo en `id` mi propio grupo con mi identificador, puedo escribir.

`chmod u-x, g-rx, o+w, o-x`
Dar / quitar permisos en una sola línea.

## 7.  Asignación de permisos (2-2)

[[useradd]] `NombreDeUsuario`
`useradd Pepe`
Añadir un usuario.

`useradd NombreDeUsuario -s SHELL -d Directorio`
`useradd Pepe -s /bin/bash -d /home/pepe`
Con `s` le decimos el SHELL que usará, y con `-d` le ponemos el nombre a su directorio personal.

[[passwd]] `Usuario`
`passwd Pepe`
Al usuario le añadimos una contraseña.


Para darle permisos de su propia carpeta a este usuario. Hay 2 opciones:
1. 
	`chgrp pepe pepe/`
	*Primero: añadimos el grupo Pepe al directorio Pepe/*
	`chown pepe pepe/`
	*Segundo: cambiamos al propietario del directorio Pepe/*
2. 
	[[chown]] `propietario:grupo directorio/`
	`chown pepe:pepe pepe/`
	*Así matamos 2 pájaros de un tiro, le añadimos el propietario Pepe y el grupo Pepe al directorio Pepe/*


[[groupadd]] `NombreDeGrupo`
`groupadd Alumnos`
Creamos el grupo Alumnos.

[[usermod]] `-a -G Grupo Usuario`
`usermod -a -G Alumnos Pepe`
Añadimos al grupo Alumnos a Pepe.

## 8. Notación octal de permisos (Otra forma de hacer lo de los permisos)

Imaginamos binario -> octal

`chmod 755 MyDirectory/`
Darle los permisos: *rwx rx rx*.


## 9. Permisos especiales - Sticky Bit

Cuidado: si tengo una carpeta en la que los permisos sean `777` *(todos pueden rwx)*, aunque tenga un archivo en el que solo una persona puede *rwx*, yo puedo eliminar, por ejemplo, este archivo... *(Porque está dentro de una carpeta en la que todos tienen permisos.*

`chmod +t MyDirectory/`
Para prevenir lo anterior.

## 10. Control de atributos de ficheros en Linux – Chattr y Lsattr

[[lsattr]] *(lo hacemos dentro del directorio)*
Nos dice los *flags* que tiene un directorio.

[[chattr]] `+i -V`
> `+i`: inmutable
> `-V`: *verbose* - al ejecutar un comando, ver de forma descriptiva lo que está pasando por detrás.

`chattr -i -V`
Quitarle lo de "inmutable".


## 11. Permisos especiales – SUID y SGID

Truquito [[xargs]]:
`comando | xargs comando`
`which python3.9 | xargs ls -l`
Aquí lo que hacemos es: a la ruta que nos devuelve el `which`, hacerle un `ls -l`

### SUID

El permiso [[SUID]] permite que un archivo se ejecute como si del propietario se tratase, independientemente del usuario que lo ejecute, el archivo se ejecutará como el propietario.

`chmod 4755`
`chmod u+s MyDirectory/`
*rws rx rx*

Descubrir binarios:
[[find]] `/ -type f -perm -4000`
"Encuéntrame desde la raíz archivos tipo files que tengan los permisos 4000 (s)".

Nos va a dar muchos errores:
`find / -type f -perm -4000 2>/dev/null` 


Hemos encontrado que `python3.9` es una `uid`, lo cuál nos permite: ejecutar `python3.9` siendo el usuario que seamos, como el propietario de forma temporal.

> `python3.9`
		Ejecutar `python3.9` como el propietario.

> `import os`
> 	Importamos la librería os

> `os.setuid(0)`
> 	Cambiamos nuestro grupo al del 0, que suele ser *root*.

> `os.system("bash")`
> 	Nos da una bash, un *root@H4cknet*



### [[SGID]] *(aplica igual que el [[SUID]] pero a nivel de grupos)*

`find / -perm -2000 2>/dev/null`
Nos salen los archivos que están operando bajo los privilegios del grupo *root*.

`chmod 2755 MyDirectory/`
Lo importante es el 2.

`chmod g+s MyDirectory/`
Esto y lo anterior son iguales.
