# 1. Direcciones IP (IPV4 e IPV6)

Para poder mirar nuestra IP en una máquina Parrot / Kali, usaremos el comando `ifconfig` o `hostname -I` y por lo general, encontraremos 2 interfaces: o el **eth0** o el **lo** (LoopBack).

_La IPv4 es la del inet, la IPv6 es la del inet6, y la netmask y el broadcast son muy importantes, que se verán más adelante.__

La IP del eth0 o ens33, es la que me identifica a mí a nivel de usuario.

Las direcciones IP son identificadores numéricos únicos que se utilizan para identificar dispositivos en una red, como ordenadores, routers, servidores y otros dispositivos conectados a Internet.


Una IP está formado por cuatro octetos (4 palabras de 3 Bytes, que equivalen a 32  bits). Para poder pasar mi IP a binario hay que hacer lo siguiente:

> `echo "$(echo "obase=2; 192" | bc).168.111.42"`

Con esto lo que decimos es, que en vez de 192, nos printee el resultado de lo que salga de convertir 192 a binario.

Para poder ver toda nuestra IP en binario, se repetiría todo el proceso del $.

> `echo "$(echo "obase=2; 192" | bc).$(echo "obase=2; 168" | bc).$(echo "obase=2; 111" | bc).$(echo "obase=2; 42" | bc)"`


# 2. Direcciones MAC (OUI y NIC)

Para ver la dirección MAC, se debe usar `ifconfig`, y fijarse en la parte en la que dice **ether**, esa será la dirección MAC.

La dirección MAC es un número hexadecimal de **12 dígitos** (número binario de **6 bytes**), que está representado principalmente por **notación hexadecimal** de dos puntos.

Los primeros **6 dígitos** (digamos **00:40:96**) del MAC Address identifican al fabricante, llamado **OUI** (**Identificador Único Organizacional**). El Comité de la Autoridad de Registro de **IEEE** asigna estos prefijos MAC a sus proveedores registrados.

Los seis dígitos más a la derecha representan el **controlador de interfaz de red**, que es asignado por el fabricante.

Es decir, los primeros **3 bytes** (**24 bits**) representan el fabricante de la tarjeta, y los últimos **3 bytes** (**24 bits**) identifican la tarjeta particular de ese fabricante. Cada grupo de **3 bytes** se puede representar con **6 dígitos hexadecimales**, formando un número hexadecimal de **12 dígitos** que representa la MAC completa.

Para una búsqueda de fabricante utilizando direcciones MAC, se requieren al menos los primeros **3 bytes** (**6 caracteres**) de la dirección MAC. Una de las herramientas que vemos en esta clase para lograr dicho fin es ‘[**macchanger**](https://www.kali.org/tools/macchanger/)‘, una herramienta de GNU/Linux para la visualización y manipulación de direcciones MAC.


Si queremos realizar un escaneo a nivel local de las direcciones MAC, haremos:

> `arp-scan -I myIPInterface --localnet`
> `arp-scan -I ens33 --localnet`

Nos devuelve la dirección IP y la MAC de los dispositivos conectados a la red.


Si queremos ver los OUI de empresas registradas:

> `macchanger -l`


# Protocolos comunes (UDP, TCP) y el famoso Three-Way Handshake

Los protocolos **TCP** (Transmission Control Protocol) y **UDP** (User Datagram Protocol) son dos de los protocolos de red más comunes utilizados en la transferencia de datos a través de redes de ordenadores.

El protocolo **TCP**, es un protocolo **orientado a la conexión** que proporciona una entrega de datos confiable, mientras que el protocolo **UDP**, es un protocolo **no orientado a conexión** el cual no garantiza la entrega de datos.

Una parte crucial del protocolo **TCP** es el **Three-Way Handshake**, un procedimiento utilizado para establecer una conexión entre dos dispositivos. Este procedimiento consta de tres pasos: **SYN**, **SYN-ACK** y **ACK**, en los que se sincronizan los números de secuencia y de reconocimiento de los paquetes entre los dispositivos. El Three-Way Handshake es fundamental para establecer una conexión confiable y segura a través de TCP.

[[Puertos]] TCP comunes:

- 21: **FTP** (File Transfer Protocol) – permite la transferencia de archivos entre sistemas.
- 22: **SSH** (Secure Shell) – un protocolo de red seguro que permite a los usuarios conectarse y administrar sistemas de forma remota.
- 23: **Telnet** – un protocolo utilizado para la conexión remota a dispositivos de red.
- 80: **HTTP** (Hypertext Transfer Protocol) – el protocolo que se utiliza para la transferencia de datos en la World Wide Web.
- 443: **HTTPS** (Hypertext Transfer Protocol Secure) – la versión segura de HTTP, que utiliza encriptación SSL/TLS para proteger las comunicaciones web.

Puertos UDP comunes:

- 53: **DNS** (Domain Name System) – un sistema que traduce nombres de dominio en direcciones IP.
- 67/68: **DHCP** (Dynamic Host Configuration Protocol) – un protocolo utilizado para asignar direcciones IP y otros parámetros de configuración a los dispositivos en una red.
- 69: **TFTP** (Trivial File Transfer Protocol) – un protocolo simple utilizado para transferir archivos entre dispositivos en una red.
- 123: **NTP** (Network Time Protocol) – un protocolo utilizado para sincronizar los relojes de los dispositivos en una red.
- 161: **SNMP** (Simple Network Management Protocol) – un protocolo utilizado para administrar y supervisar dispositivos en una red.

Cabe destacar que estos son solo **algunos de los más comunes**. Existen muchos más puertos los cuales operan tanto por TCP como por UDP.


# El modelo OSI – ¿En qué consiste y cómo se estructura la actividad de red en capas?

## Descripción 

En redes de ordenadores, el modelo **OSI** (Open Systems Interconnection) es una estructura de **siete capas** que se utiliza para describir el proceso de comunicación entre dispositivos. Cada capa proporciona servicios y funciones específicas, que permiten a los dispositivos comunicarse a través de la red.

A continuación, se describen brevemente las siete capas del modelo OSI:

1. **Capa física**: Es la capa más baja del modelo OSI, que se encarga de la transmisión de datos a través del medio físico de la red, como cables de cobre o fibra óptica.
    
2. **Capa de enlace de datos**: Esta capa se encarga de la transferencia confiable de datos entre dispositivos en la misma red. También proporciona funciones para la detección y corrección de errores en los datos transmitidos.
    
3. **Capa de red**: La capa de red se ocupa del enrutamiento de paquetes de datos a través de múltiples redes. Esta capa utiliza direcciones lógicas, como direcciones IP, para identificar dispositivos y rutas de red.
    
4. **Capa de transporte**: La capa de transporte se encarga de la entrega confiable de datos entre dispositivos finales, proporcionando servicios como el control de flujo y la corrección de errores.
    
5. **Capa de sesión**: Esta capa se encarga de establecer y mantener las sesiones de comunicación entre dispositivos. También proporciona servicios de gestión de sesiones, como la autenticación y la autorización.
    
6. **Capa de presentación**: La capa de presentación se encarga de la representación de datos, proporcionando funciones como la codificación y decodificación de datos, la compresión y el cifrado.
    
7. **Capa de aplicación**: La capa de aplicación proporciona servicios para aplicaciones de usuario finales, como correo electrónico, navegadores web y transferencia de archivos.

Comprender la estructura en capas del modelo OSI es esencial para cualquier analista de seguridad, ya que permite tener una visión completa del funcionamiento de la red y de las posibles vulnerabilidades que puedan existir en cada una de las capas.

Esto nos permite identificar de manera efectiva los puntos débiles de la red y aplicar medidas de seguridad adecuadas para protegerla de posibles ataques.

## Resumen

Con un ejemplo de Correos:

1. **Capa física**: serían las carreteras, el camino que toman los paquetes para llegar a su destino. Por aquí la información suele viajar por cables y otros dispositivos.

2. **Capa de enlace**: esta capa actúa como inspector, observa si el paquete tiene algún problema o error que vengan de la capa física, y en el caso de haberlos, corregirlos.

3. **Capa de red**: verifica quién es el emitario y el remitente. En caso de haber demasiados paquetes, también organiza los que tienen más o menos prioridad. Actúa como una oficina de correos.

4. **Capa de transporte**: aquí se encuentran los camiones y los carteros. Aquí están los protocolos TCP y UDP.

5. **Capa de sesión**: Esta capa se encarga de establecer y mantener las sesiones de comunicación entre dispositivos. También proporciona servicios de gestión de sesiones, como la autenticación y la autorización.

6. **Capa de presentación**: traduce los datos para que los use la capa de aplicación. Codifica y decodifica los datos, y en caso de que haga falta, cifrarlos.

7. **Capa de aplicación**: capa que se usa para consumir los datos. En esta capa podemos: enviar correos electrónicos, transferir archivos, acceder a sitios web, conectarnos de forma remota a otros máquinas...

	- En esta capa encontramos los protocolos más famosos como el HTTP, el FTP, 


# Subnetting – ¿Qué es y cómo se interpreta una máscara de red?

## Descripción

**Subnetting** es una técnica utilizada para dividir una red IP en subredes más pequeñas y manejables. Esto se logra mediante el uso de **máscaras de red**, que permiten definir qué bits de la dirección IP corresponden a la **red** y cuáles a los **hosts**.

Para interpretar una máscara de red, se deben identificar los bits que están en “**1**“. Estos bits representan la porción de la dirección IP que corresponde a la **red**. Por ejemplo, una máscara de red de **255.255.255.0** indica que los primeros **tres octetos** de la dirección IP corresponden a la **red**, mientras que el **último octeto** se utiliza para identificar los **hosts**.

Ahora bien, cuando hablamos de **CIDR** (acrónimo de **Classless Inter-Domain Routing**), a lo que nos referimos es a un método de asignación de direcciones IP más eficiente y flexible que el uso de clases de redes IP fijas. Con **CIDR**, una dirección IP se representa mediante una dirección IP base y una máscara de red, que se escriben juntas separadas por una barra (**/**).

Por ejemplo, la dirección IP **192.168.1.1** con una máscara de red de **255.255.255.0** se escribiría como **192.168.1.1/24**.

La máscara de red se representa en notación de prefijo, que indica el número de bits que están en “**1**” en la máscara. En este caso, la máscara de red **255.255.255.0** tiene **24** bits en “**1**” (los primeros tres octetos), por lo que su notación de prefijo es **/24**.

Para calcular la máscara de red a partir de una notación de prefijo, se deben escribir los bits “**1**” en los primeros bits de una dirección IP de 32 bits y los bits “**0**” en los bits restantes. Por ejemplo, la máscara de red **/24** se calcularía como **11111111.11111111.11111111.00000000** en binario, lo que equivale a **255.255.255.0** en decimal.

## Resumen

![[Pasted image 20230619162009.png]]

Lo recomendable es hacer un Excel, escribir la máscara de red que tenemos, e ir jugando con las 0's y 1's y puertas AND's.

En el caso del CIDR, escribimos `=CONCATENAR("/"; CONTAR.SI(A2:AI2;1))`, concatena la barra con las filas que son 1. 

# Subnetting – CIDRs y cálculo total de hosts

## Descripción

En cuanto a clases de direcciones IP, existen tres tipos de máscaras de red: **Clase A**, **Clase B** y **Clase C**.

- Las redes de **clase A** usan una máscara de subred predeterminada de **255.0.0.0** y tienen de **0** a **127** como su **primer octeto**. La dirección **10.52.36.11**, por ejemplo, es una dirección de **clase A**. Su primer octeto es **10**, que está entre **1** y **126**, ambos incluidos.
- Las redes de **clase B** usan una máscara de subred predeterminada de **255.255.0.0** y tienen de **128** a **191** como su **primer octeto**. La dirección **172.16.52.63**, por ejemplo, es una dirección de **clase B**. Su primer octeto es **172**, que está entre **128** y **191**, ambos inclusive.
- Las redes de **clase C** usan una máscara de subred predeterminada de **255.255.255.0** y tienen de **192** a **223** como su **primer octeto**. La dirección **192.168.123.132**, por ejemplo, es una dirección de **clase C**. Su primer octeto es **192**, que está entre **192** y **223**, ambos incluidos.

Es importante tener en cuenta que, además de estos tres tipos de máscaras de red, **también existen máscaras de red personalizadas** que se pueden utilizar para crear subredes de diferentes tamaños dentro de una red.

Tal y como mencionamos en la descripción de la clase anterior sobre los CIDRs (**Classless Inter-Domain Routing**), se trata de un método de asignación de direcciones IP que permite dividir una dirección IP en una parte que identifica **la red** y otra parte que identifica **el host**. Esto se logra mediante el uso de una **máscara de red**, que se representa en notación **CIDR** como una **dirección IP base** seguida de un número que indica la **cantidad de bits** que corresponden a la red.

Con **CIDR**, se pueden asignar direcciones IP de forma **más precisa**, lo que reduce la cantidad de direcciones IP desperdiciadas y facilita la administración de la red.

El número que sigue a la dirección IP base en la notación CIDR se llama **prefijo** o **longitud de prefijo**, y representa el **número de bits** en la máscara de red que están en “**1**“.

Por ejemplo, una dirección IP con un prefijo de **/24** indica que los primeros **24 bits** de la dirección IP corresponden a la **red**, mientras que los **8 bits** restantes se utilizan para identificar los **hosts**.

Para calcular la cantidad de hosts disponibles en una red CIDR, se deben contar el número de bits “**0**” en la máscara de red y elevar **2 a la potencia** de ese número. Esto se debe a que cada bit “**0**” en la máscara de red representa un bit que se puede utilizar para identificar un host.

Por ejemplo, una máscara de red de **255.255.255.0** (**/24**) tiene **8 bits** en “**0**“, lo que significa que hay **2^8 = 256** direcciones IP disponibles para los hosts en esa red.

A continuación, se representan algunos ejemplos prácticos de CIDR:

- Una dirección IP con un prefijo de **/28** **(255.255.255.240)** permite hasta **16 direcciones IP** para los hosts (**2^4**), ya que los primeros **28 bits** corresponden a la red.
- Una dirección IP con un prefijo de **/26** **(255.255.255.192)** permite hasta **64 direcciones IP** para los hosts (**2^6**), ya que los primeros **26 bits** corresponden a la red.
- Una dirección IP con un prefijo de **/22** (**255.255.252.0**) permite hasta **1024 direcciones IP** para los hosts (**2^10**), ya que los primeros **22 bits** corresponden a la red.

### Resumen


